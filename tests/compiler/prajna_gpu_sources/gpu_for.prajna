import gpu;

@test
func testGpuFor2d(){
    var shape = [10, 20];
    var tmp_tensor = Tensor<i64, 2>::create(shape);

    @gpu // 标注后, 编译器会将tmp_tensor的内存拷贝到gpu, 并在gpu上执行下面的运算
    for idx in [0, 0] to shape{
        auto x = idx[0];
        auto y = idx[1];
        tmp_tensor[x, y] = 1;
        // 等价于上面的代码
        // tmp_tensor.at(idx) = 1;
    }

    // 运行完后, gpu的数据会自动拷贝的tmp_tensor上
    for i in [0, 0] to shape{
        testing::assert(tmp_tensor.at(i) == 1);
    }
}
